# Exploit demo for dirty pipez vulnerability in Linux Kernel

During Proactive Computer Security at DIKU, we give a small
presentation about different papers/vulnerabilities/concepts.

This repo contians exploits and different payloads
for the dirty pipez vulnerability, which allows
writing to readonline files, and therefore
privilege escalation.

## Setup
We use a vagrant file to set up a VM with the correct
Linux kernel version.

First we had to find a VM with the correct linux kernel version.

According to the following table, Groovy Gorilla has version 5.8
so it should be suited for exploit development and the demo.
https://en.wikipedia.org/wiki/Ubuntu_version_history#Table_of_versions

https://app.vagrantup.com/boxes/search?utf8=%E2%9C%93&sort=downloads&provider=&q=Groovy+Gorilla

## Go through code of exploit
- focus on important parts, limitations

- what does the code do?
--> talk about source of linux kernel (when does Page can merge flag is set?)


## Payloads, demos

- Maybe a good presentation is walking through the code for the exploit
  of writing to arbitrary files and then we can show some shellcode we
  have written ourselves to spawn a

We want to present different payloads, stuff you can do with
the exploit, further it should become clear what constraints
the exploit has - whats possible and whats not.


- writing to /etc/passwd to gain user in sudo group?

### Demo: Modifying readonly files
- explore which interesting linux files we could change etc.

- example AP results from 1970, Peter Naur

- show interesting read-only file owned by root we would like to modify

- show that we cannot change permission, whoami, try to replace
 line with sed

- check uname -a --> oh interesting Linux kernel version 5.8

- sed -i "/aaa=/c\aaa=xxx" your_file_here

- understand read only files better (permissions under linux)

- make cowsay with whoami, after getting root


write shellcode to execve cowsay with whoami?
echo "Hi, $(whoami)" | cowsay


### Creating new user in root group
-> change root password
oot:42:0:0:root/root:/bin/bash

https://security.stackexchange.com/questions/151700/privilege-escalation-using-passwd-file

https://www.mrjamiebowman.com/hacking/privilege-escalation-writing-a-user-to-etc-passwd/

### Demo: Shell code + root shell

Command for writing shellcode
 ./write_anything /usr/bin/su 1 "$(cat shellcode)"

-> reinstall su binary with
   > sudo apt install --reinstall util-linux



Maybe it would also be a good alternative to show sopme
assembly (where we use SUID to execve a root shell?)

Use on SUID binary (for example /usr/bin/su):

SUID binary is a binary that is for for example owned by root and then
is allowed to execute another binary/script with the owners permission,
meaning we can write to a binary owned by root which
has the SUID flag that it should spawn
a root shell for us.


### record screencast / terminal playback of exploit
- record the demo I want to perform just as a safe backup
